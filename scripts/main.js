!function(){jQTouchCore=function(a){function b(a){"string"==typeof a.selector&&"string"==typeof a.name&&H.push(a)}function c(a,b){y.unshift({page:a,animation:b,hash:"#"+a.attr("id"),id:a.attr("id")})}function d(a){var b=w(a.target);b.is(D.join(", "))||(b=w(a.target).closest(D.join(", "))),b&&b.attr("href")&&!b.isExternalLink()&&a.preventDefault(),w.support.touch||w(a.target).trigger("tap",a)}function e(a,b,d,e){function g(){var f=F;w.support.animationEvents&&d&&A.useAnimations?(a.unbind("webkitAnimationEnd",g),a.removeClass("current "+h+" out"),b.removeClass(h),v.removeClass("animating animating3d"),A.trackScrollPositions===!0&&(b.css("top",-b.data("lastScroll")),setTimeout(function(){b.css("top",0),window.scroll(0,b.data("lastScroll")),w(".scroll",b).each(function(){this.scrollTop=-w(this).data("lastScroll")})},0))):(a.removeClass(h+" out current"),f+=260),setTimeout(function(){b.removeClass("in")},f),B=b,e?y.shift():c(B,d),a.unselect(),o(B.attr("id")),b.trigger("pageAnimationEnd",{direction:"in",animation:d}),a.trigger("pageAnimationEnd",{direction:"out",animation:d})}if(e=e?e:!1,void 0===b||0===b.length)return w.fn.unselect(),!1;if(b.hasClass("current"))return w.fn.unselect(),!1;if(w(":focus").trigger("blur"),a.trigger("pageAnimationStart",{direction:"out",back:e}),b.trigger("pageAnimationStart",{direction:"in",back:e}),w.support.animationEvents&&d&&A.useAnimations){!w.support.transform3d&&d.is3d&&(d.name=A.defaultAnimation);var h=d.name,i=d.is3d?"animating3d":"";e&&(h=h.replace(/left|right|up|down|in|out/,f)),a.bind("webkitAnimationEnd",g),v.addClass("animating "+i);var j=window.pageYOffset;A.trackScrollPositions===!0&&b.css("top",window.pageYOffset-(b.data("lastScroll")||0)),b.addClass(h+" in current"),a.addClass(h+" out"),A.trackScrollPositions===!0&&(a.data("lastScroll",j),w(".scroll",a).each(function(){w(this).data("lastScroll",this.scrollTop)}))}else b.addClass("current in"),g();return!0}function f(a){var b={up:"down",down:"up",left:"right",right:"left","in":"out",out:"in"};return b[a]||a}function g(){return C}function h(){y.length<1,1===y.length&&window.history.go(-1);var a=y[0],b=y[1];return e(a.page,b.page,a.animation,!0)?E:!1}function i(a,b){var c=y[0].page;if("string"==typeof b)for(var d=0,f=H.length;f>d;d++)if(H[d].name===b){b=H[d];break}if("string"==typeof a){var g=w(a);if(g.length<1)return p(a,{animation:b}),void 0;a=g}return e(c,a,b)?E:!1}function j(){return location.hash===y[0].hash?!0:""===location.hash?(h(),!0):y[1]&&location.hash===y[1].hash?(h(),!0):(i(w(location.hash),A.defaultAnimation),void 0)}function k(a){if(A=w.extend({},J,a),A.preloadImages)for(var b=A.preloadImages.length-1;b>=0;b--)(new Image).src=A.preloadImages[b];var c=A.addGlossToIcon?"":"-precomposed";A.icon&&(I+='<link rel="apple-touch-icon'+c+'" href="'+A.icon+'" />'),A.icon4&&(I+='<link rel="apple-touch-icon'+c+'" sizes="114x114" href="'+A.icon4+'" />'),A.startupScreen&&(I+='<link rel="apple-touch-startup-image" href="'+A.startupScreen+'" />'),A.fixedViewport&&(I+='<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>'),A.fullScreen&&(I+='<meta name="apple-mobile-web-app-capable" content="yes" />',A.statusBar&&(I+='<meta name="apple-mobile-web-app-status-bar-style" content="'+A.statusBar+'" />')),I&&x.prepend(I)}function l(a){for(var b,c=0,d=H.length;d>c;c++)if(a.is(H[c].selector)){b=H[c];break}return b||(b=A.defaultAnimation),b}function m(a,b){var c=null,d=document.createElement("div");return d.innerHTML=a,w(d).children().each(function(){var a=w(this);a.attr("id")||a.attr("id","page-"+ ++z),w("#"+a.attr("id")).remove(),v.append(a),v.trigger("pageInserted",{page:a}),(a.hasClass("current")||!c)&&(c=a)}),null!==c?(i(c,b),c):!1}function n(){v.css("minHeight",1e3),scrollTo(0,0);var a=window.innerHeight;v.css("minHeight",a),C=90==Math.abs(window.orientation)?"landscape":"portrait",v.removeClass("portrait landscape").addClass(C).trigger("turn",{orientation:C})}function o(a){location.hash="#"+a.replace(/^#/,"")}function p(a,b){var c={data:null,method:"GET",animation:null,callback:null,$referrer:null},d=w.extend({},c,b);"#"!=a?w.ajax({url:a,data:d.data,type:d.method,success:function(a){var b=m(a,d.animation);b&&("GET"==d.method&&A.cacheGetRequests===!0&&d.$referrer&&d.$referrer.attr("href","#"+b.attr("id")),d.callback&&d.callback(!0))},error:function(){d.$referrer&&d.$referrer.unselect(),d.callback&&d.callback(!1)}}):d.$referrer&&d.$referrer.unselect()}function q(a,b){w(":focus").trigger("blur"),a.preventDefault();var c="string"==typeof a?w(a).eq(0):a.target?w(a.target):w(a);return c.length&&c.is(A.formSelector)&&c.attr("action")?(p(c.attr("action"),{data:c.serialize(),method:c.attr("method")||"POST",animation:l(c),callback:b}),!1):!0}function r(a){var b=a.closest("form");return 0!==b.length?(b.trigger("submit"),!1):!0}function s(){var a,b,c,d,e;return a=document.getElementsByTagName("head")[0],b=document.body,c=document.createElement("style"),c.textContent="@media (transform-3d),(-o-transform-3d),(-moz-transform-3d),(-webkit-transform-3d){#jqt-3dtest{height:3px}}",d=document.createElement("div"),d.id="jqt-3dtest",a.appendChild(c),b.appendChild(d),e=3===d.offsetHeight,c.parentNode.removeChild(c),d.parentNode.removeChild(d),e}function t(a){var b=w(a.target),c=D.join(", ");b.is(c)||(b=b.closest(c)),b.length&&b.attr("href")&&b.addClass("active"),b.on(w.support.touch?"touchmove":"mousemove",function(){b.removeClass("active")}),b.on("touchend",function(){b.unbind("touchmove mousemove")})}function u(a){var b=w(a.target);if(b.is(D.join(", "))||(b=b.closest(D.join(", "))),!b.length||!b.attr("href"))return!1;var c=b.attr("target"),d=b.prop("hash"),e=b.attr("href"),f=null;if(b.isExternalLink())return b.unselect(),!0;if(b.is(A.backSelector))h(d);else{if(!b.is(A.submitSelector))return"_webapp"===c?(window.location=e,!1):"#"===e?(b.unselect(),!0):(f=l(b),d&&"#"!==d?(b.addClass("active"),i(w(d).data("referrer",b),f,b.hasClass("reverse")),!1):(b.addClass("loading active"),p(b.attr("href"),{animation:f,callback:function(){b.removeClass("loading"),setTimeout(w.fn.unselect,250,b)},$referrer:b}),!1));r(b)}}var v,w=a.framework,x=w("head"),y=[],z=0,A={},B="",C="portrait",D=[],E={},F=100,G=jQTouchCore.prototype.extensions,H=[],I="",J={addGlossToIcon:!0,backSelector:".back, .cancel, .goback",cacheGetRequests:!0,debug:!0,defaultAnimation:"slideleft",fixedViewport:!0,formSelector:"form",fullScreen:!0,fullScreenClass:"fullscreen",icon:null,icon4:null,preloadImages:!1,startupScreen:null,statusBar:"default",submitSelector:".submit",touchSelector:"a, .touch",trackScrollPositions:!0,useAnimations:!0,useFastTouch:!0,useTouchScroll:!0,animations:[{name:"cubeleft",selector:".cubeleft, .cube",is3d:!0},{name:"cuberight",selector:".cuberight",is3d:!0},{name:"dissolve",selector:".dissolve"},{name:"fade",selector:".fade"},{name:"flipleft",selector:".flipleft, .flip",is3d:!0},{name:"flipright",selector:".flipright",is3d:!0},{name:"pop",selector:".pop",is3d:!0},{name:"swapleft",selector:".swap",is3d:!0},{name:"slidedown",selector:".slidedown"},{name:"slideright",selector:".slideright"},{name:"slideup",selector:".slideup"},{name:"slideleft",selector:".slideleft, .slide, #jqt > * > ul li a"}]};return k(a),w(document).ready(function(){w.support||(w.support={}),w.support.animationEvents="undefined"!=typeof window.WebKitAnimationEvent,w.support.touch="undefined"!=typeof window.TouchEvent&&window.navigator.userAgent.indexOf("Mobile")>-1&&A.useFastTouch,w.support.transform3d=s(),w.support.ios5=/OS (5(_\d+)*) like Mac OS X/i.test(window.navigator.userAgent),!w.support.touch,!w.support.transform3d,w.fn.isExternalLink=function(){var a=w(this);return"_blank"==a.attr("target")||"external"==a.attr("rel")||a.is('a[href^="http://maps.google.com"], a[href^="mailto:"], a[href^="tel:"], a[href^="javascript:"], a[href*="youtube.com/v"], a[href*="youtube.com/watch"]')},w.fn.makeActive=function(){return w(this).addClass("active")},w.fn.unselect=function(a){a?a.removeClass("active"):w(".active").removeClass("active")};for(var a=0,e=G.length;e>a;a++){var f=G[a];w.isFunction(f)&&w.extend(E,f(E))}for(var g=0,h=J.animations.length;h>g;g++){var k=J.animations[g];void 0!==A[k.name+"Selector"]&&(k.selector=A[k.name+"Selector"]),b(k)}D.push(A.touchSelector),D.push(A.backSelector),D.push(A.submitSelector),w(D.join(", ")).css("-webkit-touch-callout","none"),v=w("#jqt");var l=[];0===v.length&&(v=w(document.body).attr("id","jqt")),w.support.transform3d&&l.push("supports3d"),w.support.ios5&&A.useTouchScroll&&l.push("touchscroll"),A.fullScreenClass&&window.navigator.standalone===!0&&l.push(A.fullScreenClass,A.statusBar),v.addClass(l.join(" ")).bind("click",d).bind("orientationchange",n).bind("submit",q).bind("tap",u).bind(w.support.touch?"touchstart":"mousedown",t).trigger("orientationchange"),w(window).bind("hashchange",j);var m=location.hash;B=0===w("#jqt > .current").length?w("#jqt > *:first-child").addClass("current"):w("#jqt > .current"),o(B.attr("id")),c(B),1===w(m).length&&i(m)}),E={addAnimation:b,animations:H,getOrientation:g,goBack:h,insertPages:m,goTo:i,history:y,settings:A,submitForm:q}},jQTouchCore.prototype.extensions=[],window.Zepto&&!function(a){a.jQTouch=function(b){return b.framework=a,jQTouchCore(b)},a.fn.prop=a.fn.attr,a.jQTouch.addExtension=function(a){jQTouchCore.prototype.extensions.push(a)}}(Zepto)}();var Handlebars={};!function(a,b){a.VERSION="1.0.0",a.COMPILER_REVISION=4,a.REVISION_CHANGES={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:">= 1.0.0"},a.helpers={},a.partials={};var c=Object.prototype.toString,d="[object Function]",e="[object Object]";a.registerHelper=function(b,d,f){if(c.call(b)===e){if(f||d)throw new a.Exception("Arg not supported with multiple helpers");a.Utils.extend(this.helpers,b)}else f&&(d.not=f),this.helpers[b]=d},a.registerPartial=function(b,d){c.call(b)===e?a.Utils.extend(this.partials,b):this.partials[b]=d},a.registerHelper("helperMissing",function(a){if(2===arguments.length)return b;throw new Error("Missing helper: '"+a+"'")}),a.registerHelper("blockHelperMissing",function(b,e){var f=e.inverse||function(){},g=e.fn,h=c.call(b);return h===d&&(b=b.call(this)),b===!0?g(this):b===!1||null==b?f(this):"[object Array]"===h?b.length>0?a.helpers.each(b,e):f(this):g(b)}),a.K=function(){},a.createFrame=Object.create||function(b){a.K.prototype=b;var c=new a.K;return a.K.prototype=null,c},a.logger={DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,methodMap:{0:"debug",1:"info",2:"warn",3:"error"},log:function(b,c){if(a.logger.level<=b){var d=a.logger.methodMap[b];"undefined"!=typeof console&&console[d]&&console[d].call(console,c)}}},a.log=function(b,c){a.logger.log(b,c)},a.registerHelper("each",function(b,e){var f,g=e.fn,h=e.inverse,i=0,j="",k=c.call(b);if(k===d&&(b=b.call(this)),e.data&&(f=a.createFrame(e.data)),b&&"object"==typeof b)if(b instanceof Array)for(var l=b.length;l>i;i++)f&&(f.index=i),j+=g(b[i],{data:f});else for(var m in b)b.hasOwnProperty(m)&&(f&&(f.key=m),j+=g(b[m],{data:f}),i++);return 0===i&&(j=h(this)),j}),a.registerHelper("if",function(b,e){var f=c.call(b);return f===d&&(b=b.call(this)),!b||a.Utils.isEmpty(b)?e.inverse(this):e.fn(this)}),a.registerHelper("unless",function(b,c){return a.helpers["if"].call(this,b,{fn:c.inverse,inverse:c.fn})}),a.registerHelper("with",function(b,e){var f=c.call(b);return f===d&&(b=b.call(this)),a.Utils.isEmpty(b)?void 0:e.fn(b)}),a.registerHelper("log",function(b,c){var d=c.data&&null!=c.data.level?parseInt(c.data.level,10):1;a.log(d,b)});var f=function(){function a(){this.yy={}}var b={trace:function(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,simpleInverse:6,statements:7,statement:8,openInverse:9,closeBlock:10,openBlock:11,mustache:12,partial:13,CONTENT:14,COMMENT:15,OPEN_BLOCK:16,inMustache:17,CLOSE:18,OPEN_INVERSE:19,OPEN_ENDBLOCK:20,path:21,OPEN:22,OPEN_UNESCAPED:23,CLOSE_UNESCAPED:24,OPEN_PARTIAL:25,partialName:26,params:27,hash:28,dataName:29,param:30,STRING:31,INTEGER:32,BOOLEAN:33,hashSegments:34,hashSegment:35,ID:36,EQUALS:37,DATA:38,pathSegments:39,SEP:40,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"CONTENT",15:"COMMENT",16:"OPEN_BLOCK",18:"CLOSE",19:"OPEN_INVERSE",20:"OPEN_ENDBLOCK",22:"OPEN",23:"OPEN_UNESCAPED",24:"CLOSE_UNESCAPED",25:"OPEN_PARTIAL",31:"STRING",32:"INTEGER",33:"BOOLEAN",36:"ID",37:"EQUALS",38:"DATA",40:"SEP"},productions_:[0,[3,2],[4,2],[4,3],[4,2],[4,1],[4,1],[4,0],[7,1],[7,2],[8,3],[8,3],[8,1],[8,1],[8,1],[8,1],[11,3],[9,3],[10,3],[12,3],[12,3],[13,3],[13,4],[6,2],[17,3],[17,2],[17,2],[17,1],[17,1],[27,2],[27,1],[30,1],[30,1],[30,1],[30,1],[30,1],[28,1],[34,2],[34,1],[35,3],[35,3],[35,3],[35,3],[35,3],[26,1],[26,1],[26,1],[29,2],[21,1],[39,3],[39,1]],performAction:function(a,b,c,d,e,f){var g=f.length-1;switch(e){case 1:return f[g-1];case 2:this.$=new d.ProgramNode([],f[g]);break;case 3:this.$=new d.ProgramNode(f[g-2],f[g]);break;case 4:this.$=new d.ProgramNode(f[g-1],[]);break;case 5:this.$=new d.ProgramNode(f[g]);break;case 6:this.$=new d.ProgramNode([],[]);break;case 7:this.$=new d.ProgramNode([]);break;case 8:this.$=[f[g]];break;case 9:f[g-1].push(f[g]),this.$=f[g-1];break;case 10:this.$=new d.BlockNode(f[g-2],f[g-1].inverse,f[g-1],f[g]);break;case 11:this.$=new d.BlockNode(f[g-2],f[g-1],f[g-1].inverse,f[g]);break;case 12:this.$=f[g];break;case 13:this.$=f[g];break;case 14:this.$=new d.ContentNode(f[g]);break;case 15:this.$=new d.CommentNode(f[g]);break;case 16:this.$=new d.MustacheNode(f[g-1][0],f[g-1][1]);break;case 17:this.$=new d.MustacheNode(f[g-1][0],f[g-1][1]);break;case 18:this.$=f[g-1];break;case 19:this.$=new d.MustacheNode(f[g-1][0],f[g-1][1],"&"===f[g-2][2]);break;case 20:this.$=new d.MustacheNode(f[g-1][0],f[g-1][1],!0);break;case 21:this.$=new d.PartialNode(f[g-1]);break;case 22:this.$=new d.PartialNode(f[g-2],f[g-1]);break;case 23:break;case 24:this.$=[[f[g-2]].concat(f[g-1]),f[g]];break;case 25:this.$=[[f[g-1]].concat(f[g]),null];break;case 26:this.$=[[f[g-1]],f[g]];break;case 27:this.$=[[f[g]],null];break;case 28:this.$=[[f[g]],null];break;case 29:f[g-1].push(f[g]),this.$=f[g-1];break;case 30:this.$=[f[g]];break;case 31:this.$=f[g];break;case 32:this.$=new d.StringNode(f[g]);break;case 33:this.$=new d.IntegerNode(f[g]);break;case 34:this.$=new d.BooleanNode(f[g]);break;case 35:this.$=f[g];break;case 36:this.$=new d.HashNode(f[g]);break;case 37:f[g-1].push(f[g]),this.$=f[g-1];break;case 38:this.$=[f[g]];break;case 39:this.$=[f[g-2],f[g]];break;case 40:this.$=[f[g-2],new d.StringNode(f[g])];break;case 41:this.$=[f[g-2],new d.IntegerNode(f[g])];break;case 42:this.$=[f[g-2],new d.BooleanNode(f[g])];break;case 43:this.$=[f[g-2],f[g]];break;case 44:this.$=new d.PartialNameNode(f[g]);break;case 45:this.$=new d.PartialNameNode(new d.StringNode(f[g]));break;case 46:this.$=new d.PartialNameNode(new d.IntegerNode(f[g]));break;case 47:this.$=new d.DataNode(f[g]);break;case 48:this.$=new d.IdNode(f[g]);break;case 49:f[g-2].push({part:f[g],separator:f[g-1]}),this.$=f[g-2];break;case 50:this.$=[{part:f[g]}]}},table:[{3:1,4:2,5:[2,7],6:3,7:4,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],22:[1,14],23:[1,15],25:[1,16]},{1:[3]},{5:[1,17]},{5:[2,6],7:18,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,19],20:[2,6],22:[1,14],23:[1,15],25:[1,16]},{5:[2,5],6:20,8:21,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],20:[2,5],22:[1,14],23:[1,15],25:[1,16]},{17:23,18:[1,22],21:24,29:25,36:[1,28],38:[1,27],39:26},{5:[2,8],14:[2,8],15:[2,8],16:[2,8],19:[2,8],20:[2,8],22:[2,8],23:[2,8],25:[2,8]},{4:29,6:3,7:4,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],20:[2,7],22:[1,14],23:[1,15],25:[1,16]},{4:30,6:3,7:4,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],20:[2,7],22:[1,14],23:[1,15],25:[1,16]},{5:[2,12],14:[2,12],15:[2,12],16:[2,12],19:[2,12],20:[2,12],22:[2,12],23:[2,12],25:[2,12]},{5:[2,13],14:[2,13],15:[2,13],16:[2,13],19:[2,13],20:[2,13],22:[2,13],23:[2,13],25:[2,13]},{5:[2,14],14:[2,14],15:[2,14],16:[2,14],19:[2,14],20:[2,14],22:[2,14],23:[2,14],25:[2,14]},{5:[2,15],14:[2,15],15:[2,15],16:[2,15],19:[2,15],20:[2,15],22:[2,15],23:[2,15],25:[2,15]},{17:31,21:24,29:25,36:[1,28],38:[1,27],39:26},{17:32,21:24,29:25,36:[1,28],38:[1,27],39:26},{17:33,21:24,29:25,36:[1,28],38:[1,27],39:26},{21:35,26:34,31:[1,36],32:[1,37],36:[1,28],39:26},{1:[2,1]},{5:[2,2],8:21,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,19],20:[2,2],22:[1,14],23:[1,15],25:[1,16]},{17:23,21:24,29:25,36:[1,28],38:[1,27],39:26},{5:[2,4],7:38,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,19],20:[2,4],22:[1,14],23:[1,15],25:[1,16]},{5:[2,9],14:[2,9],15:[2,9],16:[2,9],19:[2,9],20:[2,9],22:[2,9],23:[2,9],25:[2,9]},{5:[2,23],14:[2,23],15:[2,23],16:[2,23],19:[2,23],20:[2,23],22:[2,23],23:[2,23],25:[2,23]},{18:[1,39]},{18:[2,27],21:44,24:[2,27],27:40,28:41,29:48,30:42,31:[1,45],32:[1,46],33:[1,47],34:43,35:49,36:[1,50],38:[1,27],39:26},{18:[2,28],24:[2,28]},{18:[2,48],24:[2,48],31:[2,48],32:[2,48],33:[2,48],36:[2,48],38:[2,48],40:[1,51]},{21:52,36:[1,28],39:26},{18:[2,50],24:[2,50],31:[2,50],32:[2,50],33:[2,50],36:[2,50],38:[2,50],40:[2,50]},{10:53,20:[1,54]},{10:55,20:[1,54]},{18:[1,56]},{18:[1,57]},{24:[1,58]},{18:[1,59],21:60,36:[1,28],39:26},{18:[2,44],36:[2,44]},{18:[2,45],36:[2,45]},{18:[2,46],36:[2,46]},{5:[2,3],8:21,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,19],20:[2,3],22:[1,14],23:[1,15],25:[1,16]},{14:[2,17],15:[2,17],16:[2,17],19:[2,17],20:[2,17],22:[2,17],23:[2,17],25:[2,17]},{18:[2,25],21:44,24:[2,25],28:61,29:48,30:62,31:[1,45],32:[1,46],33:[1,47],34:43,35:49,36:[1,50],38:[1,27],39:26},{18:[2,26],24:[2,26]},{18:[2,30],24:[2,30],31:[2,30],32:[2,30],33:[2,30],36:[2,30],38:[2,30]},{18:[2,36],24:[2,36],35:63,36:[1,64]},{18:[2,31],24:[2,31],31:[2,31],32:[2,31],33:[2,31],36:[2,31],38:[2,31]},{18:[2,32],24:[2,32],31:[2,32],32:[2,32],33:[2,32],36:[2,32],38:[2,32]},{18:[2,33],24:[2,33],31:[2,33],32:[2,33],33:[2,33],36:[2,33],38:[2,33]},{18:[2,34],24:[2,34],31:[2,34],32:[2,34],33:[2,34],36:[2,34],38:[2,34]},{18:[2,35],24:[2,35],31:[2,35],32:[2,35],33:[2,35],36:[2,35],38:[2,35]},{18:[2,38],24:[2,38],36:[2,38]},{18:[2,50],24:[2,50],31:[2,50],32:[2,50],33:[2,50],36:[2,50],37:[1,65],38:[2,50],40:[2,50]},{36:[1,66]},{18:[2,47],24:[2,47],31:[2,47],32:[2,47],33:[2,47],36:[2,47],38:[2,47]},{5:[2,10],14:[2,10],15:[2,10],16:[2,10],19:[2,10],20:[2,10],22:[2,10],23:[2,10],25:[2,10]},{21:67,36:[1,28],39:26},{5:[2,11],14:[2,11],15:[2,11],16:[2,11],19:[2,11],20:[2,11],22:[2,11],23:[2,11],25:[2,11]},{14:[2,16],15:[2,16],16:[2,16],19:[2,16],20:[2,16],22:[2,16],23:[2,16],25:[2,16]},{5:[2,19],14:[2,19],15:[2,19],16:[2,19],19:[2,19],20:[2,19],22:[2,19],23:[2,19],25:[2,19]},{5:[2,20],14:[2,20],15:[2,20],16:[2,20],19:[2,20],20:[2,20],22:[2,20],23:[2,20],25:[2,20]},{5:[2,21],14:[2,21],15:[2,21],16:[2,21],19:[2,21],20:[2,21],22:[2,21],23:[2,21],25:[2,21]},{18:[1,68]},{18:[2,24],24:[2,24]},{18:[2,29],24:[2,29],31:[2,29],32:[2,29],33:[2,29],36:[2,29],38:[2,29]},{18:[2,37],24:[2,37],36:[2,37]},{37:[1,65]},{21:69,29:73,31:[1,70],32:[1,71],33:[1,72],36:[1,28],38:[1,27],39:26},{18:[2,49],24:[2,49],31:[2,49],32:[2,49],33:[2,49],36:[2,49],38:[2,49],40:[2,49]},{18:[1,74]},{5:[2,22],14:[2,22],15:[2,22],16:[2,22],19:[2,22],20:[2,22],22:[2,22],23:[2,22],25:[2,22]},{18:[2,39],24:[2,39],36:[2,39]},{18:[2,40],24:[2,40],36:[2,40]},{18:[2,41],24:[2,41],36:[2,41]},{18:[2,42],24:[2,42],36:[2,42]},{18:[2,43],24:[2,43],36:[2,43]},{5:[2,18],14:[2,18],15:[2,18],16:[2,18],19:[2,18],20:[2,18],22:[2,18],23:[2,18],25:[2,18]}],defaultActions:{17:[2,1]},parseError:function(a){throw new Error(a)},parse:function(a){function b(){var a;return a=c.lexer.lex()||1,"number"!=typeof a&&(a=c.symbols_[a]||a),a}var c=this,d=[0],e=[null],f=[],g=this.table,h="",i=0,j=0,k=0;this.lexer.setInput(a),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,"undefined"==typeof this.lexer.yylloc&&(this.lexer.yylloc={});var l=this.lexer.yylloc;f.push(l);var m=this.lexer.options&&this.lexer.options.ranges;"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var n,o,p,q,r,s,t,u,v,w={};;){if(p=d[d.length-1],this.defaultActions[p]?q=this.defaultActions[p]:((null===n||"undefined"==typeof n)&&(n=b()),q=g[p]&&g[p][n]),"undefined"==typeof q||!q.length||!q[0]){var x="";if(!k){v=[];for(s in g[p])this.terminals_[s]&&s>2&&v.push("'"+this.terminals_[s]+"'");x=this.lexer.showPosition?"Parse error on line "+(i+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+v.join(", ")+", got '"+(this.terminals_[n]||n)+"'":"Parse error on line "+(i+1)+": Unexpected "+(1==n?"end of input":"'"+(this.terminals_[n]||n)+"'"),this.parseError(x,{text:this.lexer.match,token:this.terminals_[n]||n,line:this.lexer.yylineno,loc:l,expected:v})}}if(q[0]instanceof Array&&q.length>1)throw new Error("Parse Error: multiple actions possible at state: "+p+", token: "+n);switch(q[0]){case 1:d.push(n),e.push(this.lexer.yytext),f.push(this.lexer.yylloc),d.push(q[1]),n=null,o?(n=o,o=null):(j=this.lexer.yyleng,h=this.lexer.yytext,i=this.lexer.yylineno,l=this.lexer.yylloc,k>0&&k--);break;case 2:if(t=this.productions_[q[1]][1],w.$=e[e.length-t],w._$={first_line:f[f.length-(t||1)].first_line,last_line:f[f.length-1].last_line,first_column:f[f.length-(t||1)].first_column,last_column:f[f.length-1].last_column},m&&(w._$.range=[f[f.length-(t||1)].range[0],f[f.length-1].range[1]]),r=this.performAction.call(w,h,j,i,this.yy,q[1],e,f),"undefined"!=typeof r)return r;t&&(d=d.slice(0,2*-1*t),e=e.slice(0,-1*t),f=f.slice(0,-1*t)),d.push(this.productions_[q[1]][0]),e.push(w.$),f.push(w._$),u=g[d[d.length-2]][d[d.length-1]],d.push(u);break;case 3:return!0}}return!0}},c=function(){var a={EOF:1,parseError:function(a,b){if(!this.yy.parser)throw new Error(a);this.yy.parser.parseError(a,b)},setInput:function(a){return this._input=a,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var a=this._input[0];this.yytext+=a,this.yyleng++,this.offset++,this.match+=a,this.matched+=a;var b=a.match(/(?:\r\n?|\n).*/g);return b?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),a},unput:function(a){var b=a.length,c=a.split(/(?:\r\n?|\n)/g);this._input=a+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-b-1),this.offset-=b;var d=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),c.length-1&&(this.yylineno-=c.length-1);var e=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:c?(c.length===d.length?this.yylloc.first_column:0)+d[d.length-c.length].length-c[0].length:this.yylloc.first_column-b},this.options.ranges&&(this.yylloc.range=[e[0],e[0]+this.yyleng-b]),this},more:function(){return this._more=!0,this},less:function(a){this.unput(this.match.slice(a))},pastInput:function(){var a=this.matched.substr(0,this.matched.length-this.match.length);return(a.length>20?"...":"")+a.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var a=this.match;return a.length<20&&(a+=this._input.substr(0,20-a.length)),(a.substr(0,20)+(a.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var a=this.pastInput(),b=new Array(a.length+1).join("-");return a+this.upcomingInput()+"\n"+b+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var a,b,c,d,e;this._more||(this.yytext="",this.match="");for(var f=this._currentRules(),g=0;g<f.length&&(c=this._input.match(this.rules[f[g]]),!c||b&&!(c[0].length>b[0].length)||(b=c,d=g,this.options.flex));g++);return b?(e=b[0].match(/(?:\r\n?|\n).*/g),e&&(this.yylineno+=e.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:e?e[e.length-1].length-e[e.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+b[0].length},this.yytext+=b[0],this.match+=b[0],this.matches=b,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(b[0].length),this.matched+=b[0],a=this.performAction.call(this,this.yy,this,f[d],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),a?a:void 0):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var a=this.next();return"undefined"!=typeof a?a:this.lex()},begin:function(a){this.conditionStack.push(a)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(a){this.begin(a)}};return a.options={},a.performAction=function(a,b,c,d){switch(c){case 0:return b.yytext="\\",14;case 1:if("\\"!==b.yytext.slice(-1)&&this.begin("mu"),"\\"===b.yytext.slice(-1)&&(b.yytext=b.yytext.substr(0,b.yyleng-1),this.begin("emu")),b.yytext)return 14;break;case 2:return 14;case 3:return"\\"!==b.yytext.slice(-1)&&this.popState(),"\\"===b.yytext.slice(-1)&&(b.yytext=b.yytext.substr(0,b.yyleng-1)),14;case 4:return b.yytext=b.yytext.substr(0,b.yyleng-4),this.popState(),15;case 5:return 25;case 6:return 16;case 7:return 20;case 8:return 19;case 9:return 19;case 10:return 23;case 11:return 22;case 12:this.popState(),this.begin("com");break;case 13:return b.yytext=b.yytext.substr(3,b.yyleng-5),this.popState(),15;case 14:return 22;case 15:return 37;case 16:return 36;case 17:return 36;case 18:return 40;case 19:break;case 20:return this.popState(),24;case 21:return this.popState(),18;case 22:return b.yytext=b.yytext.substr(1,b.yyleng-2).replace(/\\"/g,'"'),31;case 23:return b.yytext=b.yytext.substr(1,b.yyleng-2).replace(/\\'/g,"'"),31;case 24:return 38;case 25:return 33;case 26:return 33;case 27:return 32;case 28:return 36;case 29:return b.yytext=b.yytext.substr(1,b.yyleng-2),36;case 30:return"INVALID";case 31:return 5}},a.rules=[/^(?:\\\\(?=(\{\{)))/,/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|$)))/,/^(?:[\s\S]*?--\}\})/,/^(?:\{\{>)/,/^(?:\{\{#)/,/^(?:\{\{\/)/,/^(?:\{\{\^)/,/^(?:\{\{\s*else\b)/,/^(?:\{\{\{)/,/^(?:\{\{&)/,/^(?:\{\{!--)/,/^(?:\{\{![\s\S]*?\}\})/,/^(?:\{\{)/,/^(?:=)/,/^(?:\.(?=[}\/ ]))/,/^(?:\.\.)/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}\}\})/,/^(?:\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=[}\s]))/,/^(?:false(?=[}\s]))/,/^(?:-?[0-9]+(?=[}\s]))/,/^(?:[^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=[=}\s\/.]))/,/^(?:\[[^\]]*\])/,/^(?:.)/,/^(?:$)/],a.conditions={mu:{rules:[5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],inclusive:!1},emu:{rules:[3],inclusive:!1},com:{rules:[4],inclusive:!1},INITIAL:{rules:[0,1,2,31],inclusive:!0}},a}();return b.lexer=c,a.prototype=b,b.Parser=a,new a}();a.Parser=f,a.parse=function(b){return b.constructor===a.AST.ProgramNode?b:(a.Parser.yy=a.AST,a.Parser.parse(b))},a.AST={},a.AST.ProgramNode=function(b,c){this.type="program",this.statements=b,c&&(this.inverse=new a.AST.ProgramNode(c))},a.AST.MustacheNode=function(a,b,c){this.type="mustache",this.escaped=!c,this.hash=b;var d=this.id=a[0],e=this.params=a.slice(1),f=this.eligibleHelper=d.isSimple;this.isHelper=f&&(e.length||b)},a.AST.PartialNode=function(a,b){this.type="partial",this.partialName=a,this.context=b},a.AST.BlockNode=function(b,c,d,e){var f=function(b,c){if(b.original!==c.original)throw new a.Exception(b.original+" doesn't match "+c.original)};f(b.id,e),this.type="block",this.mustache=b,this.program=c,this.inverse=d,this.inverse&&!this.program&&(this.isInverse=!0)},a.AST.ContentNode=function(a){this.type="content",this.string=a},a.AST.HashNode=function(a){this.type="hash",this.pairs=a},a.AST.IdNode=function(b){this.type="ID";for(var c="",d=[],e=0,f=0,g=b.length;g>f;f++){var h=b[f].part;if(c+=(b[f].separator||"")+h,".."===h||"."===h||"this"===h){if(d.length>0)throw new a.Exception("Invalid path: "+c);".."===h?e++:this.isScoped=!0}else d.push(h)}this.original=c,this.parts=d,this.string=d.join("."),this.depth=e,this.isSimple=1===b.length&&!this.isScoped&&0===e,this.stringModeValue=this.string},a.AST.PartialNameNode=function(a){this.type="PARTIAL_NAME",this.name=a.original},a.AST.DataNode=function(a){this.type="DATA",this.id=a},a.AST.StringNode=function(a){this.type="STRING",this.original=this.string=this.stringModeValue=a},a.AST.IntegerNode=function(a){this.type="INTEGER",this.original=this.integer=a,this.stringModeValue=Number(a)},a.AST.BooleanNode=function(a){this.type="BOOLEAN",this.bool=a,this.stringModeValue="true"===a},a.AST.CommentNode=function(a){this.type="comment",this.comment=a};var g=["description","fileName","lineNumber","message","name","number","stack"];a.Exception=function(){for(var a=Error.prototype.constructor.apply(this,arguments),b=0;b<g.length;b++)this[g[b]]=a[g[b]]},a.Exception.prototype=new Error,a.SafeString=function(a){this.string=a},a.SafeString.prototype.toString=function(){return this.string.toString()};var h={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},i=/[&<>"'`]/g,j=/[&<>"'`]/,k=function(a){return h[a]||"&amp;"};a.Utils={extend:function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])},escapeExpression:function(b){return b instanceof a.SafeString?b.toString():null==b||b===!1?"":(b=b.toString(),j.test(b)?b.replace(i,k):b)},isEmpty:function(a){return a||0===a?"[object Array]"===c.call(a)&&0===a.length?!0:!1:!0}};var l=a.Compiler=function(){},m=a.JavaScriptCompiler=function(){};l.prototype={compiler:l,disassemble:function(){for(var a,b,c,d=this.opcodes,e=[],f=0,g=d.length;g>f;f++)if(a=d[f],"DECLARE"===a.opcode)e.push("DECLARE "+a.name+"="+a.value);else{b=[];for(var h=0;h<a.args.length;h++)c=a.args[h],"string"==typeof c&&(c='"'+c.replace("\n","\\n")+'"'),b.push(c);e.push(a.opcode+" "+b.join(" "))}return e.join("\n")},equals:function(a){var b=this.opcodes.length;if(a.opcodes.length!==b)return!1;for(var c=0;b>c;c++){var d=this.opcodes[c],e=a.opcodes[c];if(d.opcode!==e.opcode||d.args.length!==e.args.length)return!1;for(var f=0;f<d.args.length;f++)if(d.args[f]!==e.args[f])return!1}if(b=this.children.length,a.children.length!==b)return!1;for(c=0;b>c;c++)if(!this.children[c].equals(a.children[c]))return!1;return!0},guid:0,compile:function(a,b){this.children=[],this.depths={list:[]},this.options=b;var c=this.options.knownHelpers;if(this.options.knownHelpers={helperMissing:!0,blockHelperMissing:!0,each:!0,"if":!0,unless:!0,"with":!0,log:!0},c)for(var d in c)this.options.knownHelpers[d]=c[d];return this.program(a)},accept:function(a){return this[a.type](a)},program:function(a){var b,c=a.statements;this.opcodes=[];for(var d=0,e=c.length;e>d;d++)b=c[d],this[b.type](b);return this.isSimple=1===e,this.depths.list=this.depths.list.sort(function(a,b){return a-b}),this},compileProgram:function(a){var b,c=(new this.compiler).compile(a,this.options),d=this.guid++;this.usePartial=this.usePartial||c.usePartial,this.children[d]=c;for(var e=0,f=c.depths.list.length;f>e;e++)b=c.depths.list[e],2>b||this.addDepth(b-1);return d},block:function(a){var b=a.mustache,c=a.program,d=a.inverse;c&&(c=this.compileProgram(c)),d&&(d=this.compileProgram(d));var e=this.classifyMustache(b);"helper"===e?this.helperMustache(b,c,d):"simple"===e?(this.simpleMustache(b),this.opcode("pushProgram",c),this.opcode("pushProgram",d),this.opcode("emptyHash"),this.opcode("blockValue")):(this.ambiguousMustache(b,c,d),this.opcode("pushProgram",c),this.opcode("pushProgram",d),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue")),this.opcode("append")},hash:function(a){var b,c,d=a.pairs;this.opcode("pushHash");
for(var e=0,f=d.length;f>e;e++)b=d[e],c=b[1],this.options.stringParams?(c.depth&&this.addDepth(c.depth),this.opcode("getContext",c.depth||0),this.opcode("pushStringParam",c.stringModeValue,c.type)):this.accept(c),this.opcode("assignToHash",b[0]);this.opcode("popHash")},partial:function(a){var b=a.partialName;this.usePartial=!0,a.context?this.ID(a.context):this.opcode("push","depth0"),this.opcode("invokePartial",b.name),this.opcode("append")},content:function(a){this.opcode("appendContent",a.string)},mustache:function(a){var b=this.options,c=this.classifyMustache(a);"simple"===c?this.simpleMustache(a):"helper"===c?this.helperMustache(a):this.ambiguousMustache(a),a.escaped&&!b.noEscape?this.opcode("appendEscaped"):this.opcode("append")},ambiguousMustache:function(a,b,c){var d=a.id,e=d.parts[0],f=null!=b||null!=c;this.opcode("getContext",d.depth),this.opcode("pushProgram",b),this.opcode("pushProgram",c),this.opcode("invokeAmbiguous",e,f)},simpleMustache:function(a){var b=a.id;"DATA"===b.type?this.DATA(b):b.parts.length?this.ID(b):(this.addDepth(b.depth),this.opcode("getContext",b.depth),this.opcode("pushContext")),this.opcode("resolvePossibleLambda")},helperMustache:function(a,b,c){var d=this.setupFullMustacheParams(a,b,c),e=a.id.parts[0];if(this.options.knownHelpers[e])this.opcode("invokeKnownHelper",d.length,e);else{if(this.options.knownHelpersOnly)throw new Error("You specified knownHelpersOnly, but used the unknown helper "+e);this.opcode("invokeHelper",d.length,e)}},ID:function(a){this.addDepth(a.depth),this.opcode("getContext",a.depth);var b=a.parts[0];b?this.opcode("lookupOnContext",a.parts[0]):this.opcode("pushContext");for(var c=1,d=a.parts.length;d>c;c++)this.opcode("lookup",a.parts[c])},DATA:function(b){if(this.options.data=!0,b.id.isScoped||b.id.depth)throw new a.Exception("Scoped data references are not supported: "+b.original);this.opcode("lookupData");for(var c=b.id.parts,d=0,e=c.length;e>d;d++)this.opcode("lookup",c[d])},STRING:function(a){this.opcode("pushString",a.string)},INTEGER:function(a){this.opcode("pushLiteral",a.integer)},BOOLEAN:function(a){this.opcode("pushLiteral",a.bool)},comment:function(){},opcode:function(a){this.opcodes.push({opcode:a,args:[].slice.call(arguments,1)})},declare:function(a,b){this.opcodes.push({opcode:"DECLARE",name:a,value:b})},addDepth:function(a){if(isNaN(a))throw new Error("EWOT");0!==a&&(this.depths[a]||(this.depths[a]=!0,this.depths.list.push(a)))},classifyMustache:function(a){var b=a.isHelper,c=a.eligibleHelper,d=this.options;if(c&&!b){var e=a.id.parts[0];d.knownHelpers[e]?b=!0:d.knownHelpersOnly&&(c=!1)}return b?"helper":c?"ambiguous":"simple"},pushParams:function(a){for(var b,c=a.length;c--;)b=a[c],this.options.stringParams?(b.depth&&this.addDepth(b.depth),this.opcode("getContext",b.depth||0),this.opcode("pushStringParam",b.stringModeValue,b.type)):this[b.type](b)},setupMustacheParams:function(a){var b=a.params;return this.pushParams(b),a.hash?this.hash(a.hash):this.opcode("emptyHash"),b},setupFullMustacheParams:function(a,b,c){var d=a.params;return this.pushParams(d),this.opcode("pushProgram",b),this.opcode("pushProgram",c),a.hash?this.hash(a.hash):this.opcode("emptyHash"),d}};var n=function(a){this.value=a};m.prototype={nameLookup:function(a,b){return/^[0-9]+$/.test(b)?a+"["+b+"]":m.isValidJavaScriptVariableName(b)?a+"."+b:a+"['"+b+"']"},appendToBuffer:function(a){return this.environment.isSimple?"return "+a+";":{appendToBuffer:!0,content:a,toString:function(){return"buffer += "+a+";"}}},initializeBuffer:function(){return this.quotedString("")},namespace:"Handlebars",compile:function(b,c,d,e){this.environment=b,this.options=c||{},a.log(a.logger.DEBUG,this.environment.disassemble()+"\n\n"),this.name=this.environment.name,this.isChild=!!d,this.context=d||{programs:[],environments:[],aliases:{}},this.preamble(),this.stackSlot=0,this.stackVars=[],this.registers={list:[]},this.compileStack=[],this.inlineStack=[],this.compileChildren(b,c);var f,g=b.opcodes;for(this.i=0,r=g.length;this.i<r;this.i++)f=g[this.i],"DECLARE"===f.opcode?this[f.name]=f.value:this[f.opcode].apply(this,f.args);return this.createFunctionContext(e)},nextOpcode:function(){var a=this.environment.opcodes;return a[this.i+1]},eat:function(){this.i=this.i+1},preamble:function(){var a=[];if(this.isChild)a.push("");else{var b=this.namespace,c="helpers = this.merge(helpers, "+b+".helpers);";this.environment.usePartial&&(c=c+" partials = this.merge(partials, "+b+".partials);"),this.options.data&&(c+=" data = data || {};"),a.push(c)}this.environment.isSimple?a.push(""):a.push(", buffer = "+this.initializeBuffer()),this.lastContext=0,this.source=a},createFunctionContext:function(b){var c=this.stackVars.concat(this.registers.list);if(c.length>0&&(this.source[1]=this.source[1]+", "+c.join(", ")),!this.isChild)for(var d in this.context.aliases)this.context.aliases.hasOwnProperty(d)&&(this.source[1]=this.source[1]+", "+d+"="+this.context.aliases[d]);this.source[1]&&(this.source[1]="var "+this.source[1].substring(2)+";"),this.isChild||(this.source[1]+="\n"+this.context.programs.join("\n")+"\n"),this.environment.isSimple||this.source.push("return buffer;");for(var e=this.isChild?["depth0","data"]:["Handlebars","depth0","helpers","partials","data"],f=0,g=this.environment.depths.list.length;g>f;f++)e.push("depth"+this.environment.depths.list[f]);var h=this.mergeSource();if(!this.isChild){var i=a.COMPILER_REVISION,j=a.REVISION_CHANGES[i];h="this.compilerInfo = ["+i+",'"+j+"'];\n"+h}if(b)return e.push(h),Function.apply(this,e);var k="function "+(this.name||"")+"("+e.join(",")+") {\n  "+h+"}";return a.log(a.logger.DEBUG,k+"\n\n"),k},mergeSource:function(){for(var a,c="",d=0,e=this.source.length;e>d;d++){var f=this.source[d];f.appendToBuffer?a=a?a+"\n    + "+f.content:f.content:(a&&(c+="buffer += "+a+";\n  ",a=b),c+=f+"\n  ")}return c},blockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var a=["depth0"];this.setupParams(0,a),this.replaceStack(function(b){return a.splice(1,0,b),"blockHelperMissing.call("+a.join(", ")+")"})},ambiguousBlockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var a=["depth0"];this.setupParams(0,a);var b=this.topStack();a.splice(1,0,b),a[a.length-1]="options",this.source.push("if (!"+this.lastHelper+") { "+b+" = blockHelperMissing.call("+a.join(", ")+"); }")},appendContent:function(a){this.source.push(this.appendToBuffer(this.quotedString(a)))},append:function(){this.flushInline();var a=this.popStack();this.source.push("if("+a+" || "+a+" === 0) { "+this.appendToBuffer(a)+" }"),this.environment.isSimple&&this.source.push("else { "+this.appendToBuffer("''")+" }")},appendEscaped:function(){this.context.aliases.escapeExpression="this.escapeExpression",this.source.push(this.appendToBuffer("escapeExpression("+this.popStack()+")"))},getContext:function(a){this.lastContext!==a&&(this.lastContext=a)},lookupOnContext:function(a){this.push(this.nameLookup("depth"+this.lastContext,a,"context"))},pushContext:function(){this.pushStackLiteral("depth"+this.lastContext)},resolvePossibleLambda:function(){this.context.aliases.functionType='"function"',this.replaceStack(function(a){return"typeof "+a+" === functionType ? "+a+".apply(depth0) : "+a})},lookup:function(a){this.replaceStack(function(b){return b+" == null || "+b+" === false ? "+b+" : "+this.nameLookup(b,a,"context")})},lookupData:function(){this.push("data")},pushStringParam:function(a,b){this.pushStackLiteral("depth"+this.lastContext),this.pushString(b),"string"==typeof a?this.pushString(a):this.pushStackLiteral(a)},emptyHash:function(){this.pushStackLiteral("{}"),this.options.stringParams&&(this.register("hashTypes","{}"),this.register("hashContexts","{}"))},pushHash:function(){this.hash={values:[],types:[],contexts:[]}},popHash:function(){var a=this.hash;this.hash=b,this.options.stringParams&&(this.register("hashContexts","{"+a.contexts.join(",")+"}"),this.register("hashTypes","{"+a.types.join(",")+"}")),this.push("{\n    "+a.values.join(",\n    ")+"\n  }")},pushString:function(a){this.pushStackLiteral(this.quotedString(a))},push:function(a){return this.inlineStack.push(a),a},pushLiteral:function(a){this.pushStackLiteral(a)},pushProgram:function(a){null!=a?this.pushStackLiteral(this.programExpression(a)):this.pushStackLiteral(null)},invokeHelper:function(a,b){this.context.aliases.helperMissing="helpers.helperMissing";var c=this.lastHelper=this.setupHelper(a,b,!0),d=this.nameLookup("depth"+this.lastContext,b,"context");this.push(c.name+" || "+d),this.replaceStack(function(a){return a+" ? "+a+".call("+c.callParams+") : helperMissing.call("+c.helperMissingParams+")"})},invokeKnownHelper:function(a,b){var c=this.setupHelper(a,b);this.push(c.name+".call("+c.callParams+")")},invokeAmbiguous:function(a,b){this.context.aliases.functionType='"function"',this.pushStackLiteral("{}");var c=this.setupHelper(0,a,b),d=this.lastHelper=this.nameLookup("helpers",a,"helper"),e=this.nameLookup("depth"+this.lastContext,a,"context"),f=this.nextStack();this.source.push("if ("+f+" = "+d+") { "+f+" = "+f+".call("+c.callParams+"); }"),this.source.push("else { "+f+" = "+e+"; "+f+" = typeof "+f+" === functionType ? "+f+".apply(depth0) : "+f+"; }")},invokePartial:function(a){var b=[this.nameLookup("partials",a,"partial"),"'"+a+"'",this.popStack(),"helpers","partials"];this.options.data&&b.push("data"),this.context.aliases.self="this",this.push("self.invokePartial("+b.join(", ")+")")},assignToHash:function(a){var b,c,d=this.popStack();this.options.stringParams&&(c=this.popStack(),b=this.popStack());var e=this.hash;b&&e.contexts.push("'"+a+"': "+b),c&&e.types.push("'"+a+"': "+c),e.values.push("'"+a+"': ("+d+")")},compiler:m,compileChildren:function(a,b){for(var c,d,e=a.children,f=0,g=e.length;g>f;f++){c=e[f],d=new this.compiler;var h=this.matchExistingProgram(c);null==h?(this.context.programs.push(""),h=this.context.programs.length,c.index=h,c.name="program"+h,this.context.programs[h]=d.compile(c,b,this.context),this.context.environments[h]=c):(c.index=h,c.name="program"+h)}},matchExistingProgram:function(a){for(var b=0,c=this.context.environments.length;c>b;b++){var d=this.context.environments[b];if(d&&d.equals(a))return b}},programExpression:function(a){if(this.context.aliases.self="this",null==a)return"self.noop";for(var b,c=this.environment.children[a],d=c.depths.list,e=[c.index,c.name,"data"],f=0,g=d.length;g>f;f++)b=d[f],1===b?e.push("depth0"):e.push("depth"+(b-1));return(0===d.length?"self.program(":"self.programWithDepth(")+e.join(", ")+")"},register:function(a,b){this.useRegister(a),this.source.push(a+" = "+b+";")},useRegister:function(a){this.registers[a]||(this.registers[a]=!0,this.registers.list.push(a))},pushStackLiteral:function(a){return this.push(new n(a))},pushStack:function(a){this.flushInline();var b=this.incrStack();return a&&this.source.push(b+" = "+a+";"),this.compileStack.push(b),b},replaceStack:function(a){var b,c="",d=this.isInline();if(d){var e=this.popStack(!0);if(e instanceof n)b=e.value;else{var f=this.stackSlot?this.topStackName():this.incrStack();c="("+this.push(f)+" = "+e+"),",b=this.topStack()}}else b=this.topStack();var g=a.call(this,b);return d?((this.inlineStack.length||this.compileStack.length)&&this.popStack(),this.push("("+c+g+")")):(/^stack/.test(b)||(b=this.nextStack()),this.source.push(b+" = ("+c+g+");")),b},nextStack:function(){return this.pushStack()},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var a=this.inlineStack;if(a.length){this.inlineStack=[];for(var b=0,c=a.length;c>b;b++){var d=a[b];d instanceof n?this.compileStack.push(d):this.pushStack(d)}}},isInline:function(){return this.inlineStack.length},popStack:function(a){var b=this.isInline(),c=(b?this.inlineStack:this.compileStack).pop();return!a&&c instanceof n?c.value:(b||this.stackSlot--,c)},topStack:function(a){var b=this.isInline()?this.inlineStack:this.compileStack,c=b[b.length-1];return!a&&c instanceof n?c.value:c},quotedString:function(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")+'"'},setupHelper:function(a,b,c){var d=[];this.setupParams(a,d,c);var e=this.nameLookup("helpers",b,"helper");return{params:d,name:e,callParams:["depth0"].concat(d).join(", "),helperMissingParams:c&&["depth0",this.quotedString(b)].concat(d).join(", ")}},setupParams:function(a,b,c){var d,e,f,g=[],h=[],i=[];g.push("hash:"+this.popStack()),e=this.popStack(),f=this.popStack(),(f||e)&&(f||(this.context.aliases.self="this",f="self.noop"),e||(this.context.aliases.self="this",e="self.noop"),g.push("inverse:"+e),g.push("fn:"+f));for(var j=0;a>j;j++)d=this.popStack(),b.push(d),this.options.stringParams&&(i.push(this.popStack()),h.push(this.popStack()));return this.options.stringParams&&(g.push("contexts:["+h.join(",")+"]"),g.push("types:["+i.join(",")+"]"),g.push("hashContexts:hashContexts"),g.push("hashTypes:hashTypes")),this.options.data&&g.push("data:data"),g="{"+g.join(",")+"}",c?(this.register("options",g),b.push("options")):b.push(g),b.join(", ")}};for(var o="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield".split(" "),p=m.RESERVED_WORDS={},q=0,r=o.length;r>q;q++)p[o[q]]=!0;m.isValidJavaScriptVariableName=function(a){return!m.RESERVED_WORDS[a]&&/^[a-zA-Z_$][0-9a-zA-Z_$]+$/.test(a)?!0:!1},a.precompile=function(b,c){if(null==b||"string"!=typeof b&&b.constructor!==a.AST.ProgramNode)throw new a.Exception("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+b);c=c||{},"data"in c||(c.data=!0);var d=a.parse(b),e=(new l).compile(d,c);return(new m).compile(e,c)},a.compile=function(c,d){function e(){var e=a.parse(c),f=(new l).compile(e,d),g=(new m).compile(f,d,b,!0);return a.template(g)}if(null==c||"string"!=typeof c&&c.constructor!==a.AST.ProgramNode)throw new a.Exception("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+c);d=d||{},"data"in d||(d.data=!0);var f;return function(a,b){return f||(f=e()),f.call(this,a,b)}},a.VM={template:function(b){var c={escapeExpression:a.Utils.escapeExpression,invokePartial:a.VM.invokePartial,programs:[],program:function(b,c,d){var e=this.programs[b];return d?e=a.VM.program(b,c,d):e||(e=this.programs[b]=a.VM.program(b,c)),e},merge:function(b,c){var d=b||c;return b&&c&&(d={},a.Utils.extend(d,c),a.Utils.extend(d,b)),d},programWithDepth:a.VM.programWithDepth,noop:a.VM.noop,compilerInfo:null};return function(d,e){e=e||{};var f=b.call(c,a,d,e.helpers,e.partials,e.data),g=c.compilerInfo||[],h=g[0]||1,i=a.COMPILER_REVISION;if(h!==i){if(i>h){var j=a.REVISION_CHANGES[i],k=a.REVISION_CHANGES[h];throw"Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+j+") or downgrade your runtime to an older version ("+k+")."}throw"Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+g[1]+")."}return f}},programWithDepth:function(a,b,c){var d=Array.prototype.slice.call(arguments,3),e=function(a,e){return e=e||{},b.apply(this,[a,e.data||c].concat(d))};return e.program=a,e.depth=d.length,e},program:function(a,b,c){var d=function(a,d){return d=d||{},b(a,d.data||c)};return d.program=a,d.depth=0,d},noop:function(){return""},invokePartial:function(c,d,e,f,g,h){var i={helpers:f,partials:g,data:h};if(c===b)throw new a.Exception("The partial "+d+" could not be found");if(c instanceof Function)return c(e,i);if(a.compile)return g[d]=a.compile(c,{data:h!==b}),g[d](e,i);throw new a.Exception("The partial "+d+" could not be compiled when running in runtime-only mode")}},a.template=a.VM.template}(Handlebars),L.Control.Locate=L.Control.extend({options:{position:"topleft",drawCircle:!0,follow:!1,stopFollowingOnDrag:!1,circleStyle:{color:"#136AEC",fillColor:"#136AEC",fillOpacity:.15,weight:2,opacity:.5},markerStyle:{color:"#136AEC",fillColor:"#2A93EE",fillOpacity:.7,weight:2,opacity:.9,radius:5},followCircleStyle:{},followMarkerStyle:{},metric:!0,onLocationError:function(a){alert(a.message)},onLocationOutsideMapBounds:function(a){alert(a.options.strings.outsideMapBoundsMsg)},setView:!0,strings:{title:"Show me where I am",popup:"You are within {distance} {unit} from this point",outsideMapBoundsMsg:"You seem located outside the boundaries of the map"},locateOptions:{}},onAdd:function(a){var b=L.DomUtil.create("div","leaflet-control-locate leaflet-bar leaflet-control"),c=this;this._layer=new L.LayerGroup,this._layer.addTo(a),this._event=void 0,this._locateOptions={watch:!0},L.extend(this._locateOptions,this.options.locateOptions),L.extend(this._locateOptions,{setView:!1});var d={};L.extend(d,this.options.markerStyle,this.options.followMarkerStyle),this.options.followMarkerStyle=d,d={},L.extend(d,this.options.circleStyle,this.options.followCircleStyle),this.options.followCircleStyle=d;var e=L.DomUtil.create("a","leaflet-bar-part leaflet-bar-part-single",b);e.href="#",e.title=this.options.strings.title,L.DomEvent.on(e,"click",L.DomEvent.stopPropagation).on(e,"click",L.DomEvent.preventDefault).on(e,"click",function(){c._active&&(a.getBounds().contains(c._event.latlng)||!c.options.setView||j())?m():f()}).on(e,"dblclick",L.DomEvent.stopPropagation);var f=function(){c.options.setView&&(c._locateOnNextLocationFound=!0),c._active||a.locate(c._locateOptions),c._active=!0,c.options.follow&&h(),c._event?k():(L.DomUtil.addClass(c._container,"requesting"),L.DomUtil.removeClass(c._container,"active"),L.DomUtil.removeClass(c._container,"following"))},g=function(a){c._event&&c._event.latlng.lat===a.latlng.lat&&c._event.latlng.lng===a.latlng.lng&&c._event.accuracy===a.accuracy||c._active&&(c._event=a,c.options.follow&&c._following&&(c._locateOnNextLocationFound=!0),k())},h=function(){c._following=!0,c.options.stopFollowingOnDrag&&a.on("dragstart",i)},i=function(){c._following=!1,c.options.stopFollowingOnDrag&&a.off("dragstart",i),k()},j=function(){return void 0===c._event?!1:a.options.maxBounds&&!a.options.maxBounds.contains(c._event.latlng)},k=function(){void 0===c._event.accuracy&&(c._event.accuracy=0);var b=c._event.accuracy;c._locateOnNextLocationFound&&(j()?c.options.onLocationOutsideMapBounds(c):a.fitBounds(c._event.bounds),c._locateOnNextLocationFound=!1);var d;c.options.drawCircle&&(d=c._following?c.options.followCircleStyle:c.options.circleStyle,c._circle?c._circle.setLatLng(c._event.latlng).setRadius(b):c._circle=L.circle(c._event.latlng,b,d).addTo(c._layer));var e,f;c.options.metric?(e=b.toFixed(0),f="meters"):(e=(3.2808399*b).toFixed(0),f="feet");var g;g=c._following?c.options.followMarkerStyle:c.options.markerStyle;var h=c.options.strings.popup;c._circleMarker?c._circleMarker.setLatLng(c._event.latlng).bindPopup(L.Util.template(h,{distance:e,unit:f}))._popup.setLatLng(c._event.latlng):c._circleMarker=L.circleMarker(c._event.latlng,g).bindPopup(L.Util.template(h,{distance:e,unit:f})).addTo(c._layer),c._container&&(c._following?(L.DomUtil.removeClass(c._container,"requesting"),L.DomUtil.addClass(c._container,"active"),L.DomUtil.addClass(c._container,"following")):(L.DomUtil.removeClass(c._container,"requesting"),L.DomUtil.addClass(c._container,"active"),L.DomUtil.removeClass(c._container,"following")))},l=function(){c._active=!1,c._locateOnNextLocationFound=c.options.setView,c._following=!1};l();var m=function(){a.stopLocate(),a.off("dragstart",i),L.DomUtil.removeClass(c._container,"requesting"),L.DomUtil.removeClass(c._container,"active"),L.DomUtil.removeClass(c._container,"following"),l(),c._layer.clearLayers(),c._circleMarker=void 0,c._circle=void 0},n=function(a){3==a.code&&this._locateOptions.watch||(m(),c.options.onLocationError(a))};return a.on("locationfound",g,c),a.on("locationerror",n,c),this.locate=f,this.stopLocate=m,b}}),L.Map.addInitHook(function(){this.options.locateControl&&(this.locateControl=L.control.locate(),this.addControl(this.locateControl))}),L.control.locate=function(a){return new L.Control.Locate(a)},L.FeatureSelect=L.Class.extend({includes:L.Mixin.Events,options:{icon:L.divIcon({iconSize:[16,16],iconAnchor:[8,8],className:"leaflet-feature-selector"}),selectSize:[16,16],featureGroup:null},initialize:function(a){L.setOptions(this,a),this.options.selectSize=L.point(this.options.selectSize)},addTo:function(a){return this._map=a,this._center=a.getCenter(),this.layers={},this._marker=L.marker(this._center,{icon:this.options.icon,clickable:!1,zIndexOffset:1e3}).addTo(a),a.on("move",this._checkIntersections,this),this.options.featureGroup.on("layeradd",function(){this._checkIntersections()},this),this.options.featureGroup.on("layerremove",function(a){this._handleNoIntersection(a.layer),this._checkIntersections()},this),this},_handleIntersection:function(a){this.layers[L.stamp(a)]||(this.layers[L.stamp(a)]=a,this.justSelected.push(a))},_handleNoIntersection:function(a){this.layers[L.stamp(a)]&&(delete this.layers[L.stamp(a)],this.justUnselected.push(a))},_checkIntersections:function(){var a,b,c=this._map.project(this._center);this.justSelected=[],this.justUnselected=[],this._center=this._map.getCenter(),this._marker.setLatLng(this._center),a=L.latLngBounds(this._map.unproject([c.x+this.options.selectSize.x/2,c.y-this.options.selectSize.y/2]),this._map.unproject([c.x-this.options.selectSize.x/2,c.y+this.options.selectSize.y/2])),b=L.rectangle(a).toGeoJSON().geometry.coordinates[0],this.options.featureGroup.eachLayer(function(c){var d,e=c.feature.geometry.coordinates,f=!1;switch(c.feature.geometry.type){case"Point":e=[e];case"MultiPoint":for(d=0;d<e.length;d++)a.contains(L.latLng([e[d][1],e[d][0]]))&&(f=!0);break;case"LineString":e=[e];case"MultiLineString":for(d=0;d<e.length;d++)a.intersects(c.getBounds())&&this._lineStringsIntersect(b,e[d])&&(f=!0);break;case"Polygon":e=[e];case"MultiPolygon":for(d=0;d<e.length;d++)a.intersects(c.getBounds())&&this._pointInPolygon(this._center.lng,this._center.lat,e[d][0])&&(f=!0)}f?this._handleIntersection(c):this._handleNoIntersection(c)},this),this.justSelected.length&&this.fire("select",{layers:this.justSelected}),this.justUnselected.length&&this.fire("unselect",{layers:this.justUnselected})},_lineStringsIntersect:function(a,b){for(var c=0;c<=a.length-2;++c)for(var d=0;d<=b.length-2;++d){var e={x:a[c][1],y:a[c][0]},f={x:a[c+1][1],y:a[c+1][0]},g={x:b[d][1],y:b[d][0]},h={x:b[d+1][1],y:b[d+1][0]},i=(h.x-g.x)*(e.y-g.y)-(h.y-g.y)*(e.x-g.x),j=(f.x-e.x)*(e.y-g.y)-(f.y-e.y)*(e.x-g.x),k=(h.y-g.y)*(f.x-e.x)-(h.x-g.x)*(f.y-e.y);if(0!==k){var l=i/k,m=j/k;if(l>=0&&1>=l&&m>=0&&1>=m)return!0}}return!1},_pointInPolygon:function(a,b,c){var d,e,f,g=!1;for(e=0,f=c.length-1;e<c.length;f=e++){var h=c[e][0],i=c[e][1],j=c[f][0],k=c[f][1];d=i>b!=k>b&&(j-h)*(b-i)/(k-i)+h>a,d&&(g=!g)}return g}}),L.featureSelect=function(a){return new L.FeatureSelect(a)},function(a){"use strict";a.Config={map:{center:[40.8343,-73.9279],zoom:17,maxZoom:19,minZoom:14},layers:[{url:"http://{s}.tiles.mapbox.com/v3/openplans.map-dmar86ym/{z}/{x}/{y}.png",attribution:'<a href="http://mapbox.com/about/maps" target="_blank">Terms &amp; Feedback</a>',maxZoom:19}],previewLayers:[{url:"http://{s}.tiles.mapbox.com/v3/openplans.gcp3ekpl/{z}/{x}/{y}.png",attribution:'<a href="http://mapbox.com/about/maps" target="_blank">Terms &amp; Feedback</a>',maxZoom:19}],cartodb:{queryUrl:"https://treekit.cartodb.com/api/v2/sql/",blockfaceTable:"blockface_live",blockfaceSurveyTable:"blockface_survey_live",speciesTable:"species_list_live",treesTable:"trees_live",areasTable:"survey_areas",genusField:"latin_common_genus",speciesField:"latin_species",widelyPlantedField:"widely_planted"}}}(window.TreeKit=window.TreeKit||{}),function(a,b){"use strict";function c(a){var c,d;t.hide(),t.find("label").removeClass("btn-primary"),t.find("input").each(function(){this.checked=!1}),N.hide(),w.clearLayers(),1===a.length?(y=a[0],0===y.feature.geometry.type.indexOf("Multi")?(c=1,d=L.GeoJSON.coordsToLatLngs(y.feature.geometry.coordinates,c)[0]):(c=0,d=L.GeoJSON.coordsToLatLngs(y.feature.geometry.coordinates,c)),b("#blockid").val(y.feature.properties.blockface_id),s.text("Tap your starting point...").show(),w.addLayer(L.circleMarker(d[0],L.Util.extend({},K,{direction:1,radius:25,clickable:!0}))),w.addLayer(L.circleMarker(d[d.length-1],L.Util.extend({},K,{direction:-1,radius:25,clickable:!0})))):s.text(H).show()}function d(a,b){var c;for(c=0;c<a.length;c++)a[c].setStyle(b)}function e(){function e(a){var b,c=[];for(b in a)a.hasOwnProperty(b)&&c.push(a[b]);return c}z=L.map("map",a.Config.map);var f,g,h;for(h=0;h<a.Config.layers.length;h++)g=a.Config.layers[h],L.tileLayer(g.url,g).addTo(z);L.control.locate().addTo(z),w=L.featureGroup(),x=L.geoJson(null,{style:K}),A=window.featureSelect=L.featureSelect({featureGroup:x,selectSize:[8,8],icon:L.divIcon({iconSize:[65,65],iconAnchor:[32,32],className:"leaflet-feature-selector"})}).addTo(z),A.on("select",function(a){d(a.layers,M),c(e(A.layers))}),A.on("unselect",function(a){d(a.layers,K),c(e(A.layers))}),z.addLayer(w),z.addLayer(x),w.on("click",function(a){b("#direction").val(a.layer.options.direction),w.setStyle(K),a.layer.setStyle(M),s.text("What side of the street are you on?"),t.show()}),t.on("change","input",function(){N.show()}),f=function(c){var d=a.Config.cartodb.queryUrl+"?format=GeoJSON&q=SELECT * FROM "+a.Config.cartodb.blockfaceTable+" WHERE ST_Intersects(the_geom, ST_MakeEnvelope("+z.getBounds().toBBoxString()+",4326))";b.getJSON(d,function(a){x.clearLayers(),x.addData(a),c&&c(a)})},z.on("moveend",function(){f(function(){1===e(A.layers).length?s.text("Tap your starting point..."):s.text(H)})}),f(function(){s.text(H)})}function f(){B=L.map("previewmap",a.Config.map);var c,d,e=b("#mapper-name-input").val();for(d=0;d<a.Config.previewLayers.length;d++)c=a.Config.previewLayers[d],L.tileLayer(c.url,c).addTo(B),L.geoJson(y.feature,{style:M}).addTo(B);n(e,function(a){var b=L.geoJson(a,{style:J}).addTo(B);B.fitBounds(b.getBounds())})}function g(a){var c=!0;return a.addClass("submitted"),a.find("input, select, textarea").each(function(a,d){return b(d).is(":visible")&&!d.validity.valid?(c=!1,b(d).focus(),d.select&&d.select(),!1):void 0}),c}function h(a){var c=b(a).serializeArray(),d={};return b.each(c,function(a,b){d[b.name]=b.value}),d}function i(){var a,c={datetime:(new Date).toISOString(),trees:[]};return b("form").each(function(d,e){b(e).hasClass("treeform")?(a=h(e),a.fastigiate=a.fastigiate||!1,a.circ=a.circ||0,a.speciesconfirmed=a.speciesconfirmed||2,a.species=a.species||"Unknown",a.genus=a.genus||"Unknown",c.trees.push(a)):b.extend(c,h(e))}),c}function j(c){var d,e={},f=window.location.host+window.location.search;d="SELECT ST_X(the_geom) lng, ST_Y(the_geom) lat, zoom, area_prefix  FROM "+a.Config.cartodb.areasTable+" WHERE urlparam='"+f+"'",b.getJSON(a.Config.cartodb.queryUrl+"?q="+d,function(a){a.rows.length>0&&(e.lat=a.rows[0].lat,e.lng=a.rows[0].lng,e.zoom=a.rows[0].zoom,e.area_prefix=a.rows[0].area_prefix),c(e)})}function k(c){var d="SELECT DISTINCT "+a.Config.cartodb.widelyPlantedField+", initcap("+a.Config.cartodb.genusField+") AS "+a.Config.cartodb.genusField+", initcap("+a.Config.cartodb.speciesField+") AS "+a.Config.cartodb.speciesField+" FROM "+a.Config.cartodb.speciesTable+" ORDER BY "+a.Config.cartodb.widelyPlantedField+", "+a.Config.cartodb.genusField+", "+a.Config.cartodb.speciesField,e={};b.getJSON(a.Config.cartodb.queryUrl+"?q="+d,function(b){var d,f,g,h,i=b.rows.length;for(f=0;i>f;f++)d=b.rows[f],g=d[a.Config.cartodb.genusField],h=d[a.Config.cartodb.speciesField],e[g]||(e[g]={common:[],uncommon:[]}),d[a.Config.cartodb.widelyPlantedField]?e[g].common.push(h):e[g].uncommon.push(h);c(e)})}function l(a,c){var d,e={};return e.common=b.map(v,function(a,b){return a.common.length>0?b:void 0}),e.uncommon=b.map(v,function(a,b){return 0===a.common.length?b:void 0}),d=E({index:a,genusList:e,streetName:c})}function m(a){return a?"TRUE":"FALSE"}function n(c,d){var e=a.Config.cartodb.queryUrl+"?q=SELECT survey_id FROM "+a.Config.cartodb.blockfaceSurveyTable+" WHERE who = '"+c+"' ORDER BY created_at DESC LIMIT 1";b.getJSON(e,function(c){C=c.rows[0].survey_id;var e="WITH recent AS (   SELECT     survey_id,     array_agg(.3048*width::float order by orderonstreet) width,     array_agg(.3048*length::float order by orderonstreet) length,     array_agg(.3048*dist::float order by orderonstreet) dist,     array_agg(orderonstreet order by orderonstreet) orderonstreet   FROM "+a.Config.cartodb.treesTable+"  WHERE survey_id = "+C+"  GROUP BY survey_id ), aggs AS (   SELECT     s.blockface_id,     s.direction,     CASE WHEN lower(s.side) = 'right' THEN false ELSE true END as left_side,     s.cartodb_id, s.who, b.the_geom,     r.survey_id, width, length, dist, orderonstreet   FROM     recent r, "+a.Config.cartodb.blockfaceSurveyTable+" s, "+a.Config.cartodb.blockfaceTable+" b   WHERE     r.survey_id = s.survey_id AND     b.blockface_id = s.blockface_id ), layed AS (   SELECT     survey_id,       layoutBoxes(         ST_Transform(           CASE WHEN direction = -1 THEN ST_Reverse(          st_geometryn(the_geom,1)) ELSE           st_geometryn(the_geom,1) END,           _ST_BestSRID(the_geom::geometry)         ),         left_side,         dist,         length,         width       )     as tbeds,     orderonstreet   FROM aggs ) SELECT   survey_id,   unnest(orderonstreet) as orderonstreet,   CDB_TransformToWebmercator(unnest(tbeds)) as the_geom_webmercator,   ST_Transform(unnest(tbeds),4326) as the_geom FROM layed",f=a.Config.cartodb.queryUrl+"?format=GeoJSON&q="+e;b.getJSON(f,d)})}function o(a){var b,c,d,e,f=[],g=m(a.trees.length),h="SELECT OTK_NewBlockfaceSurvey( "+a.blockid+",'"+a.who+"',"+g+","+a.direction+",'"+a.side+"','"+a.datetime+"'::timestamp) as sid ";for((a.trees.length>0||a.quitreason)&&(h="WITH new_survey_id AS ( "+h+") "),c=0;c<a.trees.length;c++)b=a.trees[c],d="SELECT OTK_NewTree( sid, "+b.circ+","+b.dist+","+m(a.fastigiate)+",'"+b.genus+"','"+b.housenum+"',"+b.length+","+b.orderonstreet+",'"+b.position+"','"+b.species+"',"+b.speciesconfirmed+",'"+b.status+"','"+b.street+"',"+b.treenum+","+b.width,c+1===a.trees.length&&(d=d+","+a.enddist),d+=") FROM new_survey_id ",f.push(d);return a.quitreason&&(e="SELECT OTK_NewNotes( sid , '"+a.quitreason+"')FROM new_survey_id",f.push(e)),h+=f.join(" UNION ALL ")}var p,q,r,s,t,u,v,w,x,y,z,A,B,C,D=b("#tree-form-tpl").html(),E=Handlebars.compile(D),F=b("#species-option-tpl").html(),G=Handlebars.compile(F),H="Drag the map to choose your block (it will turn red)",I=1,J={opacity:.9,fillOpacity:.5,weight:2,color:"#ffff33",clickable:!1},K={opacity:.7,weight:2,color:"#4575b4",clickable:!1},M={opacity:.9,weight:3,color:"#ff0000",clickable:!1},N=b("#map-next-btn"),O=function(c,d,e){var f=o(c);b.ajax({url:a.Config.cartodb.queryUrl,data:{q:f},type:"POST",success:d,error:e})};a.init=function(){s=b("#map-alert"),t=b("#side-radio-group"),q=b("#mapper-name-input"),r=b(".mapper-name-label"),p=b("#treedetails #forms-container"),j(function(b){a.Config.map.center[0]=b.lat||a.Config.map.center[0],a.Config.map.center[1]=b.lng||a.Config.map.center[1],a.Config.map.zoom=b.zoom||a.Config.map.zoom,b.area_prefix&&(a.Config.cartodb.speciesTable=b.area_prefix+"_"+a.Config.cartodb.speciesTable),k(function(a){v=a,p.append(l(I))})}),q.on("change",function(){var a=b(this).val();window.localStorage.setItem("mapperName",a),r.text(a)}),u=new b.jQTouch({addGlossToIcon:!1,fixedViewport:!1,fullScreen:!1,fullScreenClass:"fullscreen",useFastTouch:!1,icon:null,icon4:null,preloadImages:!1,startupScreen:null,statusBar:"default",useTouchScroll:!1}),b("#startlocation").on("pageAnimationEnd",function(a,b){z||"in"!==b.direction||e()
}),b("#preview").on("pageAnimationEnd",function(a,b){B||"in"!==b.direction||f()}),b(".page").on("pageAnimationEnd",function(a,c){var d=b(a.target).find("input").first();"in"===c.direction&&d.focus()}),window.localStorage.getItem("mapperName")?(q.val(window.localStorage.getItem("mapperName")),r.text(window.localStorage.getItem("mapperName")),u.goTo("#start")):u.goTo("#login"),b("body").on("click",".page a.btn-next",function(){var a=b(this).parents(".page").find("form");g(a)&&u.goTo(b(this).attr("data-next"),"slideleft")}),b("body").on("click","#anothertree",function(){var a,c=b(this).parents(".page").find("form.treeform");g(c)&&(a=c.last().find('[name="street"]').val(),p.append(l(++I,a)))}),b("body").on("click","#no-trees-btn",function(){var a,b="Are you sure there are no trees? Ready to move to the next block?";window.confirm(b)&&(a=i(),a.hastrees=!1,a.trees=[],O(a,function(){u.goTo("#thanks","slideleft")},function(){window.alert("Unable to save. Please try again.")}))}),b("body").on("click",".remove",function(){window.confirm("Are you sure you want to remove this tree measurement?")&&(b(this).parents("form").remove(),I--)}),b("body").on("change",'input[type="radio"]',function(a){var c=b(a.target).parent("label");c.siblings().removeClass("btn-primary"),c.addClass("btn-primary")}),b("body").on("change",'select[name="genus"]',function(a){var c,d=b(a.target).parents(".treeform"),e=d.find('select[name="species"]'),f=v[a.target.value];c=G({options:{common:f?f.common:null,uncommon:f?f.uncommon:null}}),e.html(c),""===a.target.value||"UNKNOWN"===a.target.value.toUpperCase()?(e.hide(),e.val("")):e.show()}),b("body").on("change",'.treeform input[name="status"]',function(a){var c=b(a.target).parents(".treeform"),d=c.find(".alive-tree-attributes");"alive"!==a.target.value?(d.hide(),d.find("input, select, textarea").each(function(a,c){b(c).val("")})):d.show()}),b("body").on("click",'a[data-refresh="true"]',function(){window.location.reload()}),b("body").on("click",".save-btn",function(){var a,c=b(this),d=c.parents(".page").find("form");g(d)&&(a=i(),O(a,function(){u.goTo(c.attr("data-next"),"slideleft")},function(){window.alert("Unable to save. Please try again.")}))}),b("body").on("click","#bad-preview-btn",function(){var c=b(this),d="SELECT OTK_FlagSurvey("+C+")";b.ajax({url:a.Config.cartodb.queryUrl,data:{q:d},type:"POST",success:function(){u.goTo(c.attr("data-next"),"slideleft")},error:function(){window.alert("Unable to save. Please try again.")}})}),b("body").on("click",".quit-btn",function(){var a,c=b(this),d=c.parents(".page").find("form");g(d)&&(a=i(),a.trees=[],O(a,function(){u.goTo(c.attr("data-next"),"slideleft")},function(){window.alert("Unable to save. Please try again.")}))})},b(function(){a.init()})}(window.TreeKit=window.TreeKit||{},Zepto);